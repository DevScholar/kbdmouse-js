<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Keyboard Logging</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #logContainer { 
            border: 1px solid #ccc; 
            padding: 10px; 
            height: 200px; 
            overflow-y: auto; 
            background: #f5f5f5;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry { 
            margin: 2px 0; 
            padding: 2px 5px; 
            background: white;
            border-left: 3px solid #007acc;
        }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h1>Keyboard Logging Test</h1>
    <h2>Log Container:</h2>
    <div id="logContainer"></div>
    
    <h2>Test Area:</h2>
    <input type="text" id="testInput" placeholder="Type here to test keyboard events" style="width: 300px; padding: 5px;">
    
    <h2>Custom Keyboard Logging:</h2>
    <button onclick="setupCustomLogging()">Setup Custom Logging</button>
    <button onclick="testKeyboardLogging()">Test Keyboard Logging</button>
    
    <script type="module">
        import { PrefabVirtualKeyboard } from './src/prefab-virtual-keyboard.js';
        
        // Setup DOM logging container
        function addLogEntry(message) {
            const logContainer = document.getElementById('logContainer');
            if (logContainer) {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }
        
        // Test custom logging function
        window.setupCustomLogging = function() {
            const keyboard = document.querySelector('prefab-virtual-keyboard');
            if (keyboard) {
                // Override the keyboard's debug log function
                if (keyboard.debug && keyboard.debug.setLogFunction) {
                    keyboard.debug.setLogFunction(function(message) {
                        console.log('Custom log:', message);
                        addLogEntry(message);
                    });
                    addLogEntry('Custom logging setup complete!');
                } else {
                    addLogEntry('Keyboard debug functions not found');
                }
            } else {
                addLogEntry('Keyboard element not found');
            }
        };
        
        // Test keyboard logging
        window.testKeyboardLogging = function() {
            addLogEntry('Testing keyboard logging format...');
            
            // Simulate some keyboard events to test the format
            const testEvents = [
                { type: 'keydown', key: 'a', code: 'KeyA', ctrl: false, alt: false, shift: false },
                { type: 'keypress', key: 'a', code: 'KeyA', ctrl: false, alt: false, shift: false },
                { type: 'keyup', key: 'a', code: 'KeyA', ctrl: false, alt: false, shift: false },
                { type: 'keydown', key: 'A', code: 'KeyA', ctrl: true, alt: false, shift: true },
                { type: 'keyup', key: 'A', code: 'KeyA', ctrl: true, alt: false, shift: true }
            ];
            
            testEvents.forEach(event => {
                const timestamp = new Date();
                const timeStr = timestamp.toTimeString().split(' ')[0] + '.' + timestamp.getMilliseconds().toString().padStart(3, '0');
                const modStr = (event.ctrl ? 'c' : '') + (event.alt ? 'a' : '') + (event.shift ? 's' : '') || 'none';
                const logMessage = `[${timeStr}]event=${event.type},key=${event.key},code=${event.code},mod=${modStr},source=virtual`;
                addLogEntry(logMessage);
            });
        };
        
        // Add some initial logs
        addLogEntry('Test page loaded. Click buttons to test keyboard logging functionality.');
        
        // Listen to physical keyboard events for comparison
        document.getElementById('testInput').addEventListener('keydown', (e) => {
            const timestamp = new Date();
            const timeStr = timestamp.toTimeString().split(' ')[0] + '.' + timestamp.getMilliseconds().toString().padStart(3, '0');
            const modStr = (e.ctrlKey ? 'c' : '') + (e.altKey ? 'a' : '') + (e.shiftKey ? 's' : '') || 'none';
            addLogEntry(`[${timeStr}]event=keydown,key=${e.key},code=${e.code},mod=${modStr},source=physical`);
        });
        
        document.getElementById('testInput').addEventListener('keypress', (e) => {
            const timestamp = new Date();
            const timeStr = timestamp.toTimeString().split(' ')[0] + '.' + timestamp.getMilliseconds().toString().padStart(3, '0');
            const modStr = (e.ctrlKey ? 'c' : '') + (e.altKey ? 'a' : '') + (e.shiftKey ? 's' : '') || 'none';
            addLogEntry(`[${timeStr}]event=keypress,key=${e.key},code=${e.code},mod=${modStr},source=physical`);
        });
        
        document.getElementById('testInput').addEventListener('keyup', (e) => {
            const timestamp = new Date();
            const timeStr = timestamp.toTimeString().split(' ')[0] + '.' + timestamp.getMilliseconds().toString().padStart(3, '0');
            const modStr = (e.ctrlKey ? 'c' : '') + (e.altKey ? 'a' : '') + (e.shiftKey ? 's' : '') || 'none';
            addLogEntry(`[${timeStr}]event=keyup,key=${e.key},code=${e.code},mod=${modStr},source=physical`);
        });
    </script>
    
    <!-- Add a prefab virtual keyboard for testing -->
    <h2>Virtual Keyboard:</h2>
    <prefab-virtual-keyboard 
        keyboard-css-src="/qwerty-104-key-keyboard.css" 
        keyboard-html-src="/qwerty-104-key-keyboard.html"
        width="600"
        height="200">
    </prefab-virtual-keyboard>
</body>
</html>